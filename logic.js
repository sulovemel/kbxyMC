class ElfCalculator{static Characters={孤僻:[1,1.1,0.9,1,1,1],固执:[1,1.1,1,0.9,1,1],调皮:[1,1.1,1,1,0.9,1],勇敢:[1,1.1,1,1,1,0.9],坦率:[1,1,1,1,1,1],大胆:[1,0.9,1.1,1,1,1],淘气:[1,1,1.1,0.9,1,1],无虑:[1,1,1.1,1,0.9,1],悠闲:[1,1,1.1,1,1,0.9],平静:[1,1,1,1,1,1],保守:[1,0.9,1,1.1,1,1],稳重:[1,1,0.9,1.1,1,1],马虎:[1,1,1,1.1,0.9,1],冷静:[1,1,1,1.1,1,0.9],认真:[1,1,1,1,1,1],沉着:[1,0.9,1,1,1.1,1],温顺:[1,1,0.9,1,1.1,1],慎重:[1,1,1,0.9,1.1,1],狂妄:[1,1,1,1,1.1,0.9],实干:[1,1,1,1,1,1],胆小:[1,0.9,1,1,1,1.1],急躁:[1,1,0.9,1,1,1.1],开朗:[1,1,1,0.9,1,1.1],天真:[1,1,1,1,0.9,1.1],浮躁:[1,1,1,1,1,1],极限:[1,1.1,1.1,1.1,1.1,1.1],};static AptitudeAdd=[2.5,8.5,14.5,22,28.5,31];static LevelCeiling=100;static createStats(value){return{strength:value||0,attack:value||0,defence:value||0,magic:value||0,resistance:value||0,speed:value||0,}}constructor(o){this.elf_data=o.elf_data;this.name=o.name||'圣光天尊';this.level=o.level||100;this.character=o.character||'孤僻';this.aptitude=o.aptitude||ElfCalculator.createStats(5);this.learningPower=o.learningPower||ElfCalculator.createStats()}calculatePowerValue(raceValue,aptitudeValue,learningPower,level,difference,characterMultiplier){return parseInt(((raceValue*2+aptitudeValue+learningPower/4)*(level/ElfCalculator.LevelCeiling)+difference)*characterMultiplier)}computingPowerValue(){const _o=Object.assign({},ElfCalculator.createStats(0));let index=0;for(const item of Object.keys(_o)){const powerValue=this.calculatePowerValue(this.elf_data[this.name][item],ElfCalculator.AptitudeAdd[this.aptitude[item]],this.learningPower[item],this.level,item==='strength'?this.level+10:5,ElfCalculator.Characters[this.character][index++]);_o[item]=powerValue}return _o}computingPowerMaxValue(){const _o=Object.assign({},ElfCalculator.createStats(0));let index=0;for(const item of Object.keys(_o)){const powerValue=this.calculatePowerValue(this.elf_data[this.name][item],ElfCalculator.AptitudeAdd[5],255,100,item==='strength'?110:5,ElfCalculator.Characters['极限'][index++]);_o[item]=powerValue}return _o}}const EC=new ElfCalculator({elf_data,});const input_learningPower=document.querySelectorAll('.xw');input_learningPower.forEach(element=>{element.addEventListener('change',e=>{const _that=e.target;const val=_that.value*1;EC.learningPower[_that.dataset.type]=val;const{strength,attack,defence,magic,resistance,speed}=EC.learningPower;const xwH=strength+attack+defence+magic+resistance+speed;if(xwH>510){_that.value=val-(xwH-510)<0?0:val-(xwH-510);EC.learningPower[_that.dataset.type]=_that.value*1}})});document.querySelector('.btn-clear-xw').addEventListener('click',e=>{input_learningPower.forEach(el=>(el.value=''));EC.learningPower=ElfCalculator.createStats()});document.querySelector('.level').addEventListener('change',e=>{EC.level=e.target.value*1});document.querySelectorAll('.aptitude').forEach(element=>{element.addEventListener('change',e=>{const type=e.target.dataset.type;EC.aptitude[type]=e.target.value*1;})});document.getElementById('character').addEventListener('change',e=>{const selectedValue=e.target.value;const element={0.9:"<span style='color: green'>0.9⬇</span>",1:'1',1.1:"<span style='color: red'>1.1⬆</span>",};document.querySelectorAll('.character').forEach((item,index)=>{item.innerHTML=element[ElfCalculator.Characters[selectedValue][index]]});EC.character=selectedValue});const results=document.getElementById('results');document.getElementById('search-box').addEventListener('input',e=>{results.innerHTML='';let searchTerm=e.target.value.trim().toLowerCase();if(searchTerm==='')return;let keys=Object.keys(EC.elf_data);keys.forEach(key=>{if(key.toLowerCase().includes(searchTerm)){displayResult(key)}})});function displayResult(key){const resultItem=document.createElement('div');resultItem.className='result-item';resultItem.textContent=key;resultItem.onclick=()=>{if(EC.name!==key){EC.name=key;showDetails(key,EC.elf_data[key]);friendlyLink(key,EC.elf_data[key]);showPicture(key)}};results.appendChild(resultItem)}function showDetails(key,elf){document.querySelector('.elfName').innerHTML=key;document.querySelectorAll('.race').forEach(item=>{item.innerHTML=elf[item.dataset.type]})}function loadImage(src,signal){return new Promise((resolve,reject)=>{const img=new Image();img.onload=()=>resolve(img);img.onerror=reject;img.src=src;signal.addEventListener('abort',()=>{img.onload=null;img.onerror=null;reject(new DOMException('图像加载被中断','AbortError'))})})}let currentController=null;async function showPicture(key){document.querySelector('.overlay').classList.add('show');if(currentController){currentController.abort()}currentController=new AbortController();try{const img=await loadImage(`./monsterswf/${key}.svg`,currentController.signal);document.querySelector('.elf-img').src=img.src;document.querySelector('.overlay').classList.remove('show')}catch(error){if(error.name==='AbortError'){console.log('图像加载被中断')}else{console.error('图像加载失败:',error)}}}function friendlyLink(key,elf){const content=elf.msg?`友情链接：<a target="_blank"href="https://www.bilibili.com/read/${elf.msg}"title="来源：浩爱，bilibili UID：18218735">${key}解析</a>`:'';document.querySelector('.msg').innerHTML=content}document.querySelector('.compute').addEventListener('click',()=>{const{strength,attack,defence,magic,resistance,speed}=EC.learningPower;const xwH=strength+attack+defence+magic+resistance+speed;if(xwH>510){alert('各项修为值合计不得超过510，当前超出：'+(xwH-510));return}const _o=EC.computingPowerValue();document.querySelectorAll('.capacity').forEach(item=>{item.innerHTML=`<span title="能力值">${_o[item.dataset.type]}</span>`})});document.querySelector('.compute-max').addEventListener('click',()=>{const _o=EC.computingPowerMaxValue();document.querySelectorAll('.capacity').forEach(item=>{const type=item.dataset.type;const ly=type==='strength'?50:30;item.innerHTML=`<span style="color:red"title="极限值">${_o[type]+ly}</span>`})});