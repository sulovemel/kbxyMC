class ElfCalculator{static Characters={孤僻:[1,1.1,0.9,1,1,1],固执:[1,1.1,1,0.9,1,1],调皮:[1,1.1,1,1,0.9,1],勇敢:[1,1.1,1,1,1,0.9],坦率:[1,1,1,1,1,1],大胆:[1,0.9,1.1,1,1,1],淘气:[1,1,1.1,0.9,1,1],无虑:[1,1,1.1,1,0.9,1],悠闲:[1,1,1.1,1,1,0.9],平静:[1,1,1,1,1,1],保守:[1,0.9,1,1.1,1,1],稳重:[1,1,0.9,1.1,1,1],马虎:[1,1,1,1.1,0.9,1],冷静:[1,1,1,1.1,1,0.9],认真:[1,1,1,1,1,1],沉着:[1,0.9,1,1,1.1,1],温顺:[1,1,0.9,1,1.1,1],慎重:[1,1,1,0.9,1.1,1],狂妄:[1,1,1,1,1.1,0.9],实干:[1,1,1,1,1,1],胆小:[1,0.9,1,1,1,1.1],急躁:[1,1,0.9,1,1,1.1],开朗:[1,1,1,0.9,1,1.1],天真:[1,1,1,1,0.9,1.1],浮躁:[1,1,1,1,1,1],极限:[1,1.1,1.1,1.1,1.1,1.1],};static AptitudeAdd=[2.5,8.5,14.5,22,28.5,31];static LevelCeiling=100;static createStats(e){return{strength:e||0,attack:e||0,defence:e||0,magic:e||0,resistance:e||0,speed:e||0,}}constructor(e){(this.elf_data=e.elf_data),(this.name=e.name||'圣光天尊'),(this.level=e.level||100),(this.character=e.character||'孤僻'),(this.aptitude=e.aptitude||ElfCalculator.createStats(5)),(this.learningPower=e.learningPower||ElfCalculator.createStats())}calculatePowerValue(e,t,a,r,l,n){return parseInt(((2*e+t+a/4)*(r/ElfCalculator.LevelCeiling)+l)*n)}computingPowerValue(){const e=Object.assign({},ElfCalculator.createStats(0));let t=0;for(const a of Object.keys(e)){const r=this.calculatePowerValue(this.elf_data[this.name][a],ElfCalculator.AptitudeAdd[this.aptitude[a]],this.learningPower[a],this.level,'strength'===a?this.level+10:5,ElfCalculator.Characters[this.character][t++]);e[a]=r}return e}computingPowerMaxValue(){const e=Object.assign({},ElfCalculator.createStats(0));let t=0;for(const a of Object.keys(e)){const r=this.calculatePowerValue(this.elf_data[this.name][a],ElfCalculator.AptitudeAdd[5],255,100,'strength'===a?110:5,ElfCalculator.Characters['极限'][t++]);e[a]=r}return e}}const EC=new ElfCalculator({elf_data:elf_data,aptitude:{strength:0,attack:1,defence:2,magic:3,resistance:4,speed:5,},}),input_learningPower=document.querySelectorAll('.xw'),select_aptitude=document.querySelectorAll('.aptitude');input_learningPower.forEach(e=>{e.addEventListener('change',e=>{const t=e.target,a=1*t.value;EC.learningPower[t.dataset.type]=a;const{strength:r,attack:l,defence:n,magic:c,resistance:o,speed:s,}=EC.learningPower,i=r+l+n+c+o+s;i>510&&((t.value=a-(i-510)<0?0:a-(i-510)),(EC.learningPower[t.dataset.type]=1*t.value),popupTips('各项修为值合计不得超过510，已自动修正！'))})}),document.querySelector('.btn-clear-xw').addEventListener('click',()=>{input_learningPower.forEach(e=>(e.value='')),(EC.learningPower=ElfCalculator.createStats())}),document.querySelector('.btn-clear-zz').addEventListener('click',()=>{select_aptitude.forEach(e=>{(e.value='5'),(e.className='aptitude option-bg5')}),(EC.aptitude=ElfCalculator.createStats(5))}),document.querySelector('.level').addEventListener('change',function(){EC.level=1*this.value}),select_aptitude.forEach(e=>{e.addEventListener('change',function(){const e=this.dataset.type;(this.className=`aptitude option-bg${this.value}`),(EC.aptitude[e]=1*this.value)})}),document.getElementById('character').addEventListener('change',e=>{const t=e.target.value,a={0.9:"<span style='color: green'>0.9⬇</span>",1:'1',1.1:"<span style='color: red'>1.1⬆</span>",};document.querySelectorAll('.character').forEach((e,r)=>{e.innerHTML=a[ElfCalculator.Characters[t][r]]}),(EC.character=t)});const results=document.getElementById('results');document.getElementById('search-box').addEventListener('input',e=>{results.innerHTML='';let t=e.target.value.trim().toLowerCase();''!==t&&Object.keys(EC.elf_data).forEach(e=>{e.toLowerCase().includes(t)&&displayResult(e)})});let currentController=null,isElf=!1;const elfImg=document.querySelector('.elf-img');function removeClassShow(){document.querySelector('.overlay').classList.add('show')}function displayResult(e){const t=document.createElement('div');(t.className='result-item'),(t.textContent=e),(t.onclick=()=>{if(EC.name===e)return;(EC.name=e),showDetails(e,EC.elf_data[e]),friendlyLink(e,EC.elf_data[e]);const t=url_data[e]?.c?'https://newsimg.5054399.com/uploads/userup'+url_data[e].c:'',a=`./monsterswf/${e}.svg`;showPicture(isElf?a:t,removeClassShow,e=>{(elfImg.src=e.src),(elfImg.dataset.url=isElf?t:a)})}),results.appendChild(t)}function showDetails(e,t){(document.querySelector('.elfName').innerHTML=e),document.querySelectorAll('.race').forEach(e=>{e.innerHTML=t[e.dataset.type]})}function loadImage(e,t){return new Promise((a,r)=>{const l=new Image();(l.onload=()=>a(l)),(l.onerror=r),(l.src=e),t.addEventListener('abort',()=>{(l.onload=null),(l.onerror=null),r(new DOMException('图像加载被中断','AbortError'))})})}async function showPicture(e,t,a){t(),currentController&&currentController.abort(),(currentController=new AbortController());try{a(await loadImage(e,currentController.signal))}catch(e){'AbortError'===e.name?popupTips('图像加载被中断！'):(popupTips('图像加载失败！',e),document.querySelector('.overlay').classList.remove('show'))}}const exhibition=document.querySelector('.exhibition');function friendlyLink(e,t){const a=url_data[e];let r=a?.p?`妖怪详情链接：<a target="_blank"href="https://news.4399.com${a.p}"title="来源：4399卡布西游">${e}</a>`:'',l=t.msg?`&nbsp;&nbsp;友情链接：<a target="_blank"href="https://www.bilibili.com/read/${t.msg}"title="来源：浩爱，bilibili UID：18218735">${e}解析</a>`:'';document.querySelector('.msg').innerHTML=r+l}exhibition.addEventListener('click',()=>{exhibition.classList.add('hidden')}),elfImg.addEventListener('load',function(){document.querySelector('.overlay').classList.remove('show')}),elfImg.addEventListener('error',()=>{document.querySelector('.overlay').classList.remove('show'),popupTips('图片加载失败！')}),elfImg.addEventListener('click',function(e){(exhibition.innerHTML=`<img src="${this.src}"alt="elf"/>`),exhibition.classList.remove('hidden')}),document.querySelector('.toggle-img-src').addEventListener('click',()=>{const e=elfImg.src,t=elfImg.dataset.url;t?showPicture(t,removeClassShow,t=>{(elfImg.src=t.src),(elfImg.dataset.url=e),(isElf=!isElf)}):popupTips('该图片不存在')}),document.querySelector('.compute').addEventListener('click',()=>{const e=EC.computingPowerValue();document.querySelectorAll('.capacity').forEach(t=>{t.innerHTML=`<span title="能力值">${e[t.dataset.type]}</span>`})}),document.querySelector('.compute-max').addEventListener('click',()=>{const e=EC.computingPowerMaxValue();document.querySelectorAll('.capacity').forEach(t=>{const a=t.dataset.type,r='strength'===a?50:30;t.innerHTML=`<span class="limit"title="极限值">${e[a]+r}</span>`;})});
